<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Favicon -->
    <link rel="icon" href="/favicon_ico/favicon.ico" type="image/x-icon" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trashcan - Forensics in the Windows Recycle Bin</title>

    <link rel="stylesheet" href="/CSS/style.css" />
    <link rel="stylesheet" href="/CSS/blog.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      integrity="sha384-wFjoQjtV1y5jVHbt0p35Ui8aV8GVpEZkyF99OXWqP/eNJDU93D3Ugxkoyh6Y2I4A"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha384-/o6I2CkkWC//PSjvWC/eYN7l3xM3tJm8ZzVkCOfp//W05QcE3mlGskpoHB6XqI+B"
      crossorigin="anonymous"
    />

    <!-- Prism.js -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"
      integrity="sha384-06z5D//U/xpvxZHuUz92xBvq3DqBBFi7Up53HRrbV7Jlv7Yvh/MZ7oenfUe9iCEt"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"
      integrity="sha384-9WmlN8ABpoFSSHvBGGjhvB3E/D8UkNB9HpLJjBQFC2VSQsM1odiQDv4NbEo+7l15"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"
      integrity="sha384-WJdEkJKrbsqw0evQ4GB6mlsKe5cGTxBOw4KAEIa52ZLB7DDpliGkwdme/HMa5n1m"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <header>
      <!-- Navigation -->
      <nav class="navbar" aria-label="Primary">
        <div class="navbar-inner">
          <div class="logo">
            <a href="/index.html">CYB3R4Y4</a>
          </div>

          <ul class="nav-links">
            <li><a href="/index.html">Home</a></li>
            <li><a href="/blog.html">Blog</a></li>
            <li><a href="/tags.html">Tags</a></li>
            <li><a href="/categories.html">Categories</a></li>
            <li><a href="mailto:aj.raya@proton.me">Contact</a></li>
          </ul>

          <button
            id="theme-toggle"
            class="theme-toggle"
            aria-label="Toggle theme"
          >
            <i id="theme-icon" class="fa-solid fa-sun" aria-hidden="true"></i>
            <span class="sr-only">Toggle theme</span>
          </button>
        </div>
      </nav>
    </header>

    <main>
      <section class="section" aria-labelledby="post-title">
        <article class="post-container">
          <h1 id="post-title">
            Trashcan - Forensics in the Windows Recycle Bin
          </h1>

          <div class="post-meta" aria-label="Post metadata">
            <span class="author">
              <i class="fa-solid fa-user" aria-hidden="true"></i>
              <address style="display: inline">AJ Raya</address>
            </span>
            <span class="date">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-10-11">October 11, 2025</time>
            </span>
          </div>

          <div class="blog-meta-row" aria-label="Category">
            <span class="blog-meta-label">Category:</span>
            <a href="/categories.html#forensics" class="tag-pill category-pill">
              Forensics
            </a>
          </div>

          <p class="muted tags-line" aria-label="Tags">
            Tags:
            <a href="/tags.html#windows" class="tag-pill">windows</a>
          </p>

          <figure>
            <img src="/Images/trashcan/trashcan.png" alt="Trashcan" />
          </figure>

          <figure>
            <img
              src="/Images/trashcan/chall-prompt.png"
              alt="Trashcan challenge prompt"
            />
            <figcaption>
              Challenge prompt hinting at tampered Recycle Bin metadata.
            </figcaption>
          </figure>

          <blockquote>
            <strong>Challenge Prompt:</strong><br />
            Have you ever done forensics on the Recycle Bin? It’s… a bit of a
            mess. Looks like the threat actor pulled some tricks to hide data
            here though. The metadata might not be what it should be. Can you
            find a flag?
          </blockquote>

          <hr />

          <h2>1. Unzipping the challenge and initial exploration</h2>

          <p>
            After extracting <code class="inside-code">trashcan.zip</code>, the
            directory structure immediately looked familiar. It resembled a
            Windows <strong>Recycle Bin</strong> layout.
          </p>

          <figure>
            <img
              src="/Images/trashcan/ls.png"
              alt="Recycle Bin file structure with $I and $R files"
            />
            <figcaption>
              The extracted archive mirrors a Windows Recycle Bin directory.
            </figcaption>
          </figure>

          <pre><code class="language-bash">$I
$R</code></pre>

          <p>From prior forensics work, this mapping was clear:</p>

          <ul>
            <li>
              <code class="inside-code">$I</code> files store
              <strong>metadata</strong> (original path, deletion time, file
              size).
            </li>
            <li>
              <code class="inside-code">$R</code> files contain the
              <strong>actual deleted data</strong>.
            </li>
          </ul>

          <p>
            Each <code class="inside-code">$Ixxxxx.txt</code> typically
            corresponds to a matching
            <code class="inside-code">$Rxxxxx.txt</code>. Naturally, I checked
            the <code class="inside-code">$R</code> files first.
          </p>

          <hr />

          <h2>2. Inspecting the <code class="inside-code">$R</code> files</h2>

          <p>
            I split the files into separate directories and ran
            <code class="inside-code">strings</code> across everything in the
            <code class="inside-code">R</code> folder:
          </p>

          <pre><code class="language-bash">strings *</code></pre>

          <figure>
            <img
              src="/Images/trashcan/strings.png"
              alt="Repeated decoy strings in $R files"
            />
            <figcaption>
              Every <code class="inside-code">$R</code> file contained the same
              decoy text.
            </figcaption>
          </figure>

          <p>Every file repeated the same phrase:</p>

          <!-- Prism doesn't have "text" loaded here; keep it unhighlighted -->
          <pre><code class="language-none">When did I throw this out!?!?</code></pre>

          <p>
            No metadata. No variation. Just noise. These were clearly
            <strong>decoy files</strong>.
          </p>

          <hr />

          <h2>
            3. Turning attention to the
            <code class="inside-code">$I</code> files
          </h2>

          <p>
            With <code class="inside-code">$R</code> ruled out, I pivoted to the
            metadata files.
          </p>

          <pre><code class="language-none">$I01XCGF.txt
$I08ZI07.txt
$I17RAD1.txt
$I198LLE.txt
...</code></pre>

          <figure>
            <img
              src="/Images/trashcan/i-files.png"
              alt="I files with similar but not identical timestamps"
            />
            <figcaption>
              Hundreds of small metadata files with subtly different timestamps.
            </figcaption>
          </figure>

          <p>I hex-dumped one of them to see what was inside:</p>

          <figure>
            <img src="/Images/trashcan/hexdump.png" alt="Hex dump screenshot" />
            <figcaption>
              Hex dump of an <code class="inside-code">$I</code> file showing
              UTF-16LE patterns.
            </figcaption>
          </figure>

          <pre><code class="language-bash">xxd '$I01XCGF.txt'</code></pre>

          <pre><code class="language-none">00000010: 4300 3a00 5c00 5500 7300 6500 7200 7300  C:\Users
00000020: 5c00 6600 6c00 6100 6700 5c00 4400 6500  \flag\De
00000030: 7300 6b00 7400 6f00 7000 5c00 6600 6c00  sktop\fl
00000040: 6100 6700 2e00 7400 7800 7400 00         ag.txt.</code></pre>

          <p>That decoded cleanly as UTF-16LE and pointed to:</p>

          <pre><code class="language-none">C:\Users\flag\Desktop\flag.txt</code></pre>

          <p>
            At that moment it clicked - the
            <strong>metadata itself</strong> was being abused to hide the flag.
          </p>

          <hr />

          <h2>4. Sorting and automating with Python</h2>

          <p>
            I wanted to inspect all <code class="inside-code">$I</code> files in
            <strong>chronological order</strong> and dump their hex
            automatically. So I wrote a small Python helper:
          </p>

          <pre><code class="language-python">#!/usr/bin/env python3
import os
import subprocess
from pathlib import Path

target_dir = Path.cwd()

files = [f for f in target_dir.iterdir() if f.is_file()]
files.sort(key=lambda f: f.stat().st_mtime)

for file in files:
    print(f"\n=== {file.name} ===")
    subprocess.run(["xxd", str(file)])</code></pre>

          <p>
            Reviewing the output, I noticed something odd - the
            <strong>original file size field</strong> changed between files and
            mapped cleanly to printable ASCII values.
          </p>

          <figure>
            <img
              src="/Images/trashcan/ascii.png"
              alt="File size field changing across $I files"
            />
            <figcaption>
              The original file size field appeared to encode characters.
            </figcaption>
          </figure>

          <hr />

          <h2>
            5. Decoding the <code class="inside-code">$I</code> file structure
          </h2>

          <p>
            A Windows Recycle Bin <code class="inside-code">$I</code> file
            (version 2) follows a known structure:
          </p>

          <figure>
            <img
              src="/Images/trashcan/file-structure.png"
              alt="Recycle Bin $I file structure diagram"
            />
            <figcaption>
              Field layout for version 2
              <code class="inside-code">$I</code> files.
            </figcaption>
          </figure>

          <p>
            I wrote a second Python script to parse these fields correctly and
            extract the encoded message:
          </p>

          <pre><code class="language-python">#!/usr/bin/env python3
import struct
from pathlib import Path

I_DIR = Path("I")
rows = []

for p in sorted(I_DIR.glob("$I*.txt")):
    b = p.read_bytes()
    if len(b) &lt; 0x1C:
        continue
    version = struct.unpack("&lt;I", b[0x00:0x04])[0]
    if version != 2:
        continue
    size = struct.unpack("&lt;Q", b[0x08:0x10])[0]
    del_time = struct.unpack("&lt;Q", b[0x10:0x18])[0]
    rows.append((del_time, size))

rows.sort(key=lambda x: x[0])
message = "".join(chr(sz) for _, sz in rows if 32 &lt;= sz &lt;= 126)
print(message)</code></pre>

          <p>The output was close… but obviously obfuscated:</p>

          <figure>
            <img
              src="/Images/trashcan/elongated-flag.png"
              alt="Obfuscated repeated-character flag string"
            />
            <figcaption>
              The extracted string looked like a flag, but with repeated
              characters.
            </figcaption>
          </figure>

          <pre><code class="language-none">ffflllaaaggg{{{111ddd222bbb222bbb000555666777111eeeddd111eeeeee555888111222666777888888555000ddd555eee333222999}}}</code></pre>

          <hr />

          <h2>6. Understanding the repetition pattern</h2>

          <p>
            Every character was repeated - usually three times, sometimes six.
            That hinted at intentional run-length encoding.
          </p>

          <p>
            Collapsing duplicates naively got close, but not correct. The fix
            was to divide run lengths by three.
          </p>

          <pre><code class="language-python">s="ffflllaaaggg{{{111ddd222bbb222bbb000555666777111eeeddd111eeeeee555888111222666777888888555000ddd555eee333222999}}}"
out=[]
i=0
while i&lt;len(s):
    j=i+1
    while j&lt;len(s) and s[j]==s[i]:
        j+=1
    out.append(s[i]*((j-i)//3))
    i=j
print(''.join(out))</code></pre>

          <p>That finally decoded to the correct flag:</p>

          <pre><code class="language-none">flag{1d2b2b05671ed1ee5812678850d5e329}</code></pre>

          <figure>
            <img
              src="/Images/trashcan/chall-complete.png"
              alt="Challenge complete"
            />
            <figcaption>Submitted the flag - accepted.</figcaption>
          </figure>

          <hr />

          <h2>Lessons learned</h2>

          <ol>
            <li>
              <strong>Recycle Bin artifacts matter.</strong><br />
              <code class="inside-code">$I</code> files contain structured
              metadata that can be weaponized.
            </li>
            <li>
              <strong>Metadata can hide data.</strong><br />
              The flag wasn’t in file contents, but in a metadata field.
            </li>
            <li>
              <strong>Patterns beat brute force.</strong><br />
              Recognizing repetition saved time over blind guessing.
            </li>
          </ol>

          <hr />

          <h2>Related MITRE ATT&amp;CK techniques</h2>

          <ul>
            <li>
              <a
                class="mitre-link"
                href="https://attack.mitre.org/techniques/T1070/004/"
                target="_blank"
                rel="noopener noreferrer"
                referrerpolicy="no-referrer"
                >T1070.004 - File Deletion</a
              >
              - abuse of deletion artifacts to hide data.
            </li>
            <li>
              <a
                class="mitre-link"
                href="https://attack.mitre.org/techniques/T1027/"
                target="_blank"
                rel="noopener noreferrer"
                referrerpolicy="no-referrer"
                >T1027 - Obfuscated Files or Information</a
              >
              - encoding data in metadata fields.
            </li>
          </ul>
        </article>
      </section>
    </main>

    <!-- Fullscreen image modal -->
    <div
      class="image-modal"
      id="image-modal"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
      aria-label="Image preview"
      tabindex="-1"
    >
      <button class="image-modal-close" type="button" aria-label="Close image">
        &times;
      </button>
      <img src="" alt="" />
    </div>

    <footer class="footer">
      &copy; 2026 Cyb3Raya. All rights reserved.
      <a href="/privacy.html">Privacy Policy</a>
    </footer>

    <!-- Dark mode logic -->
    <script>
      const themeIcon = document.getElementById("theme-icon");
      const themeToggle = document.getElementById("theme-toggle");
      const storedTheme = localStorage.getItem("theme");

      function setToggleState(isDark) {
        if (themeToggle)
          themeToggle.setAttribute("aria-pressed", String(isDark));
      }

      function enableDark() {
        document.body.classList.add("dark-mode");
        themeIcon.classList.replace("fa-sun", "fa-moon");
        setToggleState(true);
      }

      function enableLight() {
        document.body.classList.remove("dark-mode");
        themeIcon.classList.replace("fa-moon", "fa-sun");
        setToggleState(false);
      }

      if (
        storedTheme === "dark" ||
        (!storedTheme &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        enableDark();
      } else {
        enableLight();
      }

      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          if (document.body.classList.contains("dark-mode")) {
            enableLight();
            localStorage.setItem("theme", "light");
          } else {
            enableDark();
            localStorage.setItem("theme", "dark");
          }
        });
      }
    </script>

    <!-- Image zoom modal logic -->
    <script>
      (function () {
        const modal = document.getElementById("image-modal");
        if (!modal) return;

        const modalImg = modal.querySelector("img");
        const closeBtn = modal.querySelector(".image-modal-close");

        function openModal(src, alt) {
          modalImg.src = src;
          modalImg.alt = alt || "";
          modal.classList.add("open");
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
          modal.focus();
        }

        function closeModal() {
          modal.classList.remove("open");
          modal.setAttribute("aria-hidden", "true");
          modalImg.src = "";
          document.body.style.overflow = "";
        }

        document.querySelectorAll(".post-container img").forEach((img) => {
          img.addEventListener("click", () => {
            openModal(img.src, img.alt);
          });

          img.setAttribute("tabindex", "0");
          img.setAttribute("role", "button");
          img.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              openModal(img.src, img.alt);
            }
          });
        });

        modal.addEventListener("click", (e) => {
          if (e.target === modal || e.target === closeBtn) {
            closeModal();
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("open")) {
            closeModal();
          }
        });
      })();
    </script>

    <!-- Code block copy buttons -->
    <script>
      (function () {
        const codeBlocks = document.querySelectorAll(
          ".post-container pre > code"
        );
        if (!codeBlocks.length) return;

        codeBlocks.forEach((code) => {
          const pre = code.parentElement;
          if (!pre) return;

          pre.classList.add("code-block");

          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "code-copy-btn";
          btn.setAttribute("aria-label", "Copy code to clipboard");
          btn.innerHTML = `
            <i class="fa-regular fa-clipboard" aria-hidden="true"></i>
            <span>Copy</span>
          `;

          btn.addEventListener("click", async () => {
            const text = code.innerText || code.textContent || "";

            const copy = async () => {
              if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text);
              }

              const textarea = document.createElement("textarea");
              textarea.value = text;
              textarea.style.position = "fixed";
              textarea.style.left = "-9999px";
              document.body.appendChild(textarea);
              textarea.select();
              try {
                document.execCommand("copy");
              } finally {
                document.body.removeChild(textarea);
              }
            };

            try {
              await copy();
              btn.classList.add("copied");
              btn.innerHTML = `
                <i class="fa-solid fa-check" aria-hidden="true"></i>
                <span>Copied</span>
              `;
              setTimeout(() => {
                btn.classList.remove("copied");
                btn.innerHTML = `
                  <i class="fa-regular fa-clipboard" aria-hidden="true"></i>
                  <span>Copy</span>
                `;
              }, 1500);
            } catch (err) {
              console.error("Copy failed:", err);
              btn.classList.add("copied");
              btn.innerHTML = `
                <i class="fa-solid fa-triangle-exclamation" aria-hidden="true"></i>
                <span>Error</span>
              `;
              setTimeout(() => {
                btn.classList.remove("copied");
                btn.innerHTML = `
                  <i class="fa-regular fa-clipboard" aria-hidden="true"></i>
                  <span>Copy</span>
                `;
              }, 2000);
            }
          });

          pre.appendChild(btn);
        });
      })();
    </script>
  </body>
</html>
